<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Calendar Exporter</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide React icons as inline SVGs
        const Calendar = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Download = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Plus = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const X = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Clock = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const BookOpen = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );

        const Star = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        );

        function AcademicCalendar() {
            const [events, setEvents] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [formData, setFormData] = useState({
                type: 'class',
                title: '',
                description: '',
                date: '',
                startTime: '',
                endTime: '',
                location: '',
                recurrence: 'none',
                daysOfWeek: []
            });

            const eventTypes = {
                class: { label: 'Class', color: 'bg-blue-500', icon: BookOpen },
                homework: { label: 'Homework Due', color: 'bg-orange-500', icon: Clock },
                important: { label: 'Important Date', color: 'bg-purple-500', icon: Star }
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleDayToggle = (day) => {
                setFormData(prev => ({
                    ...prev,
                    daysOfWeek: prev.daysOfWeek.includes(day)
                        ? prev.daysOfWeek.filter(d => d !== day)
                        : [...prev.daysOfWeek, day]
                }));
            };

            const addEvent = () => {
                if (!formData.title || !formData.date) return;
                
                setEvents(prev => [...prev, { ...formData, id: Date.now() }]);
                setFormData({
                    type: 'class',
                    title: '',
                    description: '',
                    date: '',
                    startTime: '',
                    endTime: '',
                    location: '',
                    recurrence: 'none',
                    daysOfWeek: []
                });
                setShowForm(false);
            };

            const deleteEvent = (id) => {
                setEvents(prev => prev.filter(e => e.id !== id));
            };

            const formatICSDate = (dateStr, timeStr) => {
                const date = new Date(dateStr);
                if (timeStr) {
                    const [hours, minutes] = timeStr.split(':');
                    date.setHours(parseInt(hours), parseInt(minutes), 0);
                }
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };

            const generateRecurrenceRule = (event) => {
                if (event.recurrence === 'none') return '';
                
                const freq = event.recurrence.toUpperCase();
                let rule = `RRULE:FREQ=${freq}`;
                
                if (event.recurrence === 'weekly' && event.daysOfWeek.length > 0) {
                    const days = event.daysOfWeek.map(d => d.toUpperCase().slice(0, 2)).join(',');
                    rule += `;BYDAY=${days}`;
                }
                
                rule += ';COUNT=16';
                
                return rule;
            };

            const exportToICS = () => {
                let icsContent = [
                    'BEGIN:VCALENDAR',
                    'VERSION:2.0',
                    'PRODID:-//Academic Calendar//EN',
                    'CALSCALE:GREGORIAN',
                    'METHOD:PUBLISH',
                    'X-WR-CALNAME:Academic Calendar',
                    'X-WR-TIMEZONE:UTC'
                ];

                events.forEach(event => {
                    const dtStart = formatICSDate(event.date, event.startTime);
                    const dtEnd = event.endTime 
                        ? formatICSDate(event.date, event.endTime)
                        : formatICSDate(event.date, event.startTime || '23:59');

                    icsContent.push('BEGIN:VEVENT');
                    icsContent.push(`UID:${event.id}@academiccalendar`);
                    icsContent.push(`DTSTAMP:${formatICSDate(new Date().toISOString().split('T')[0], '00:00')}`);
                    icsContent.push(`DTSTART:${dtStart}`);
                    icsContent.push(`DTEND:${dtEnd}`);
                    icsContent.push(`SUMMARY:${event.title}`);
                    
                    if (event.description) {
                        icsContent.push(`DESCRIPTION:${event.description.replace(/\n/g, '\\n')}`);
                    }
                    
                    if (event.location) {
                        icsContent.push(`LOCATION:${event.location}`);
                    }

                    const recurrenceRule = generateRecurrenceRule(event);
                    if (recurrenceRule) {
                        icsContent.push(recurrenceRule);
                    }

                    icsContent.push('END:VEVENT');
                });

                icsContent.push('END:VCALENDAR');

                const blob = new Blob([icsContent.join('\r\n')], { type: 'text/calendar;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'academic_calendar.ics';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            };

            const sortedEvents = [...events].sort((a, b) => new Date(a.date) - new Date(b.date));

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                            <div className="flex items-center justify-between mb-6">
                                <div className="flex items-center gap-3">
                                    <Calendar className="w-8 h-8 text-indigo-600" />
                                    <h1 className="text-3xl font-bold text-gray-800">Academic Calendar</h1>
                                </div>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowForm(!showForm)}
                                        className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                    >
                                        <Plus className="w-5 h-5" />
                                        Add Event
                                    </button>
                                    {events.length > 0 && (
                                        <button
                                            onClick={exportToICS}
                                            className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
                                        >
                                            <Download className="w-5 h-5" />
                                            Export Calendar
                                        </button>
                                    )}
                                </div>
                            </div>

                            {showForm && (
                                <div className="bg-gray-50 rounded-lg p-6 mb-6 border-2 border-indigo-200">
                                    <h2 className="text-xl font-semibold mb-4 text-gray-800">Add New Event</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Event Type</label>
                                            <select
                                                name="type"
                                                value={formData.type}
                                                onChange={handleInputChange}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            >
                                                {Object.entries(eventTypes).map(([key, { label }]) => (
                                                    <option key={key} value={key}>{label}</option>
                                                ))}
                                            </select>
                                        </div>

                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                                            <input
                                                type="text"
                                                name="title"
                                                value={formData.title}
                                                onChange={handleInputChange}
                                                placeholder="e.g., Math 101 Lecture"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            />
                                        </div>

                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                            <textarea
                                                name="description"
                                                value={formData.description}
                                                onChange={handleInputChange}
                                                placeholder="Additional details..."
                                                rows="2"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                                            <input
                                                type="date"
                                                name="date"
                                                value={formData.date}
                                                onChange={handleInputChange}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                            <input
                                                type="text"
                                                name="location"
                                                value={formData.location}
                                                onChange={handleInputChange}
                                                placeholder="e.g., Room 204"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                                            <input
                                                type="time"
                                                name="startTime"
                                                value={formData.startTime}
                                                onChange={handleInputChange}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                                            <input
                                                type="time"
                                                name="endTime"
                                                value={formData.endTime}
                                                onChange={handleInputChange}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            />
                                        </div>

                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Recurrence</label>
                                            <select
                                                name="recurrence"
                                                value={formData.recurrence}
                                                onChange={handleInputChange}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            >
                                                <option value="none">None</option>
                                                <option value="daily">Daily</option>
                                                <option value="weekly">Weekly</option>
                                            </select>
                                        </div>

                                        {formData.recurrence === 'weekly' && (
                                            <div className="md:col-span-2">
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Repeat on Days</label>
                                                <div className="flex gap-2 flex-wrap">
                                                    {['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'].map(day => (
                                                        <button
                                                            key={day}
                                                            type="button"
                                                            onClick={() => handleDayToggle(day)}
                                                            className={`px-3 py-1 rounded-lg text-sm font-medium transition ${
                                                                formData.daysOfWeek.includes(day)
                                                                    ? 'bg-indigo-600 text-white'
                                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                            }`}
                                                        >
                                                            {day.slice(0, 3)}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    <div className="flex gap-3 mt-6">
                                        <button
                                            onClick={addEvent}
                                            className="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition font-medium"
                                        >
                                            Add Event
                                        </button>
                                        <button
                                            onClick={() => setShowForm(false)}
                                            className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            )}

                            {events.length === 0 ? (
                                <div className="text-center py-12">
                                    <Calendar className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                    <p className="text-gray-500 text-lg">No events yet. Click "Add Event" to get started!</p>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    {sortedEvents.map(event => {
                                        const EventIcon = eventTypes[event.type].icon;
                                        return (
                                            <div
                                                key={event.id}
                                                className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-md transition"
                                            >
                                                <div className={`${eventTypes[event.type].color} p-2 rounded-lg`}>
                                                    <EventIcon className="w-5 h-5 text-white" />
                                                </div>
                                                
                                                <div className="flex-1 min-w-0">
                                                    <div className="flex items-start justify-between gap-2">
                                                        <h3 className="font-semibold text-gray-800">{event.title}</h3>
                                                        <button
                                                            onClick={() => deleteEvent(event.id)}
                                                            className="text-gray-400 hover:text-red-500 transition"
                                                        >
                                                            <X className="w-5 h-5" />
                                                        </button>
                                                    </div>
                                                    
                                                    <div className="text-sm text-gray-600 mt-1 space-y-1">
                                                        <p className="flex items-center gap-2">
                                                            <span className="font-medium">
                                                                {new Date(event.date).toLocaleDateString('en-US', { 
                                                                    weekday: 'short', 
                                                                    year: 'numeric', 
                                                                    month: 'short', 
                                                                    day: 'numeric' 
                                                                })}
                                                            </span>
                                                            {event.startTime && (
                                                                <span>• {event.startTime}{event.endTime ? ` - ${event.endTime}` : ''}</span>
                                                            )}
                                                        </p>
                                                        {event.location && <p>📍 {event.location}</p>}
                                                        {event.description && <p className="text-gray-500">{event.description}</p>}
                                                        {event.recurrence !== 'none' && (
                                                            <p className="text-indigo-600 text-xs">
                                                                🔄 Repeats {event.recurrence}
                                                                {event.daysOfWeek.length > 0 && ` on ${event.daysOfWeek.map(d => d.slice(0, 3)).join(', ')}`}
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>

                        <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <p className="text-sm text-blue-800">
                                <strong>💡 Tip:</strong> After exporting, open the .ics file with Outlook, Apple Calendar, or Google Calendar to import all your events.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AcademicCalendar />, document.getElementById('root'));
    </script>
</body>
</html>